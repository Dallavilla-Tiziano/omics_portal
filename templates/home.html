{% extends '_base.html' %}
{% load static %}

{% block title %}Home{% endblock title %}

{% block content %}

<!-- Home Section (Full-width Hero Image) -->
<div class="home-section">
    <img class="home-image" src="{% static 'images/omics_db_home.png' %}">
    <div class="home-overlay">
        <h1>Welcome to Omics DB</h1>
        <p>Your comprehensive database for patient sample analysis.</p>
    </div>
</div>

<!-- Statistics and Charts Section -->
<div class="container mt-5">
    <div class="row justify-content-center">
        <!-- Total Patients Card -->
        <div class="col-md-4 d-flex justify-content-center">
            <div class="stat-card">
                <h2 id="total-patients">{{ total_patients }}</h2>
                <p>Total Patients</p>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="row justify-content-center mt-4">
        <div class="col-md-4 d-flex justify-content-center">
            <div class="chart-card">
                <h5>Distribution by Nation</h5>
                <canvas id="nationChart"></canvas>
            </div>
        </div>
        <div class="col-md-4 d-flex justify-content-center">
            <div class="chart-card">
                <h5>Distribution by Sex</h5>
                <canvas id="sexChart"></canvas>
            </div>
        </div>
        <div class="col-md-4 d-flex justify-content-center">
            <div class="chart-card">
                <h5>Date of Birth Distribution</h5>
                <canvas id="dobChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js Script -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const nationData = JSON.parse('{{ nation_distribution|escapejs }}');
    const sexData = JSON.parse('{{ sex_distribution|escapejs }}');
    const dobData = JSON.parse('{{ dob_distribution|escapejs }}');

    const createChart = (id, label, data, type = 'doughnut') => {
        new Chart(document.getElementById(id), {
            type: type,
            data: {
                labels: Object.keys(data),
                datasets: [{
                    data: Object.values(data),
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,  // Ensures correct behavior
                layout: { padding: 20 },
            }
        });
    };

    createChart("nationChart", "Patients by Nation", nationData);
    createChart("sexChart", "Patients by Sex", sexData);

    new Chart(document.getElementById("dobChart"), {
        type: 'bar',
        data: {
            labels: Object.keys(dobData),
            datasets: [{
                label: 'Patients by Year of Birth',
                data: Object.values(dobData),
                backgroundColor: '#36A2EB'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,  // Prevents infinite stretching
            scales: {
                x: { title: { display: true, text: 'Year' } },
                y: { title: { display: true, text: 'Number of Patients' } }
            }
        }
    });
  });
</script>

{% endblock content %}
